---
paths: messages/**/*.json, i18n/**/*.ts, app/[locale]/**/*.{ts,tsx}
---

# i18n (next-intl)

## Non-negotiables

- Localized routes under `app/[locale]/...`
- Translations in `messages/` (per locale JSON files)
- No hardcoded user-facing strings that should be translated
- Language switcher preserves route when possible

## Workflow

1. **Add/change message keys**:
   - Add to default locale JSON
   - Add same keys to other locale JSONs (avoid runtime "missing key" noise)

2. **Use correct next-intl API**:
   - Server Components: server-safe APIs
   - Client Components: `useTranslations`, `useLocale` (only in `'use client'`)

3. **Locale routing changes**:
   - Keep `app/[locale]` as source of truth
   - Ensure links/redirects preserve locale
   - Language switcher shouldn't drop query params or route segments

## Verification

- Typecheck: `pnpm -s exec tsc -p tsconfig.json --noEmit`
- E2E (if navigation/locale switching changed): `pnpm test:e2e`

## Trigger Prompts

- "Add translations for the sell flow fields"
- "Fix missing key warnings in next-intl"
- "Update language switcher to preserve current route"
