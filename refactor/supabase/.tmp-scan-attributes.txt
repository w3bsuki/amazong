lib\attributes\normalize-attribute-key.ts:3: * - products.attributes JSONB keys
docs\prompts\supabase-refactor-session.md:108:- **Verify first:** `mcp_supabase_execute_sql` → check if any product_attributes reference inactive category_attributes
app\api\revalidate\route.ts:341:      attributes: {
docs\generated\db-schema.md:46:| `product_attributes` | ✅ | 0 | 0 | 20251215100000... |
docs\generated\db-schema.md:139:### product_attributes
lib\supabase\database.types.ts:619:      category_attributes: {
lib\supabase\database.types.ts:1198:      product_attributes: {
lib\supabase\database.types.ts:1228:            foreignKeyName: "product_attributes_attribute_id_fkey"
lib\supabase\database.types.ts:1235:            foreignKeyName: "product_attributes_product_id_fkey"
lib\supabase\database.types.ts:1242:            foreignKeyName: "product_attributes_product_id_fkey"
lib\supabase\database.types.ts:2985:      sync_product_attributes_jsonb: {
docs\database.md:37:| `product_attributes` / `category_attributes` | Dynamic attributes per category (`category_attributes.is_active` flags unused definitions) |
lib\data\products\types.ts:74:  product_attributes?: Array<{
lib\data\products\normalize.ts:90:  // products.attributes jsonb (fast filtering source)
lib\data\products\normalize.ts:104:  // product_attributes rows (canonical item specifics)
lib\data\products\normalize.ts:105:  for (const row of p.product_attributes ?? []) {
lib\data\products\normalize.ts:166:  product_attributes?: Array<{ name: string; value: string }> | null
lib\data\products\normalize.ts:206:    product_attributes: p.product_attributes ?? null,
app\api\products\newest\route.ts:133:  product_attributes: Array<{ name: string; value: string }> | null
refactor\supabase\AUDIT.md:15:| **Products/Catalog** | `products`, `product_images`, `product_variants`, `variant_options`, `product_attributes`, `product_private`, `categories`, `category_attributes`, `brands` |
refactor\supabase\AUDIT.md:44:auto_set_fashion_gender             handle_product_attributes_sync
refactor\supabase\AUDIT.md:62:handle_new_user                     sync_product_attributes_jsonb
refactor\supabase\AUDIT.md:87:get_conversation_messages   sync_product_attributes_jsonb
refactor\supabase\AUDIT.md:149:| product_attributes | 1 | - | - | - | - |
refactor\supabase\CATEGORY-REDESIGN.md:250:| `product_attributes` (73 rows) | `product_aspects` |
refactor\supabase\CATEGORY-REDESIGN-v2.md:168:- `products.attributes` JSONB (on the row)
refactor\supabase\CATEGORY-REDESIGN-v2.md:169:- `product_attributes` table (EAV: product_id, attribute_id, name, value)
refactor\supabase\CATEGORY-REDESIGN-v2.md:171:**Decision:** `product_attributes` table is canonical source of truth. `products.attributes` JSONB is derived (regenerated by DB trigger on attribute insert/update/delete). No app-level dual-write.
refactor\supabase\CATEGORY-REDESIGN-v2.md:174:-- Trigger: sync product_attributes → products.attributes JSONB
refactor\supabase\CATEGORY-REDESIGN-v2.md:175:CREATE OR REPLACE FUNCTION sync_product_attributes_to_jsonb()
refactor\supabase\CATEGORY-REDESIGN-v2.md:180:    FROM product_attributes pa
refactor\supabase\CATEGORY-REDESIGN-v2.md:238:     FROM product_attributes pa 
refactor\supabase\CATEGORY-REDESIGN-v2.md:256:-- On product_attributes INSERT/UPDATE/DELETE  
refactor\supabase\CATEGORY-REDESIGN-v2.md:257:CREATE TRIGGER trg_product_attributes_search_sync
refactor\supabase\CATEGORY-REDESIGN-v2.md:258:  AFTER INSERT OR UPDATE OR DELETE ON product_attributes
refactor\supabase\CATEGORY-REDESIGN-v2.md:278:  FROM product_attributes pa
refactor\supabase\CATEGORY-REDESIGN-v2.md:337:3c. Establish canonical write path (product_attributes → products.attributes sync)
app\actions\products-create.ts:153:      const { error: attributeError } = await supabase.from("product_attributes").insert(attributeRows)
app\[locale]\(sell)\_actions\sell.ts:267:  const { error: attrError } = await supabase.from("product_attributes").insert(attributeRecords)
app\[locale]\(main)\_components\desktop\use-desktop-home-controller.ts:160:    attributes: {},
app\[locale]\(main)\_components\desktop\use-desktop-home-controller.ts:233:    setFilters((previous) => ({ ...previous, attributes: {} }))
app\[locale]\(main)\_components\filters\shared\state\use-pending-filters.ts:36:    attributes: {},
supabase\migrations\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:53:DROP POLICY IF EXISTS "Sellers can manage their product attributes" ON public.product_attributes;
supabase\migrations\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:68:CREATE INDEX IF NOT EXISTS idx_product_attributes_attribute_id 
supabase\migrations\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:69:  ON public.product_attributes(attribute_id);
supabase\migrations\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:140:DROP POLICY IF EXISTS "Product attributes are viewable by everyone" ON public.product_attributes;
supabase\migrations\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:142:  ON public.product_attributes FOR SELECT TO authenticated, anon 
supabase\migrations\20251203095427_products_attributes_jsonb.sql:42:COMMENT ON COLUMN public.products.attributes IS 
supabase\migrations\20251202164050_add_category_attributes_system.sql:31:CREATE TABLE IF NOT EXISTS product_attributes (
supabase\migrations\20251202164050_add_category_attributes_system.sql:46:CREATE INDEX IF NOT EXISTS idx_product_attributes_product ON product_attributes(product_id);
supabase\migrations\20251202164050_add_category_attributes_system.sql:47:CREATE INDEX IF NOT EXISTS idx_product_attributes_filterable ON product_attributes(name, value) 
supabase\migrations\20251202164050_add_category_attributes_system.sql:52:ALTER TABLE product_attributes ENABLE ROW LEVEL SECURITY;
supabase\migrations\20251202164050_add_category_attributes_system.sql:62:  ON product_attributes FOR SELECT
supabase\migrations\20251202164050_add_category_attributes_system.sql:66:  ON product_attributes FOR ALL
supabase\migrations\20251202164050_add_category_attributes_system.sql:70:      WHERE p.id = product_attributes.product_id 
supabase\migrations\20251202164050_add_category_attributes_system.sql:77:COMMENT ON TABLE product_attributes IS 'Stores product attribute values - both predefined and custom seller fields';
supabase\migrations\20251202164050_add_category_attributes_system.sql:78:COMMENT ON COLUMN product_attributes.is_custom IS 'True if seller added this attribute themselves (not from category template)';
supabase\migrations_legacy_sync_20260223193150\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:53:DROP POLICY IF EXISTS "Sellers can manage their product attributes" ON public.product_attributes;
supabase\migrations_legacy_sync_20260223193150\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:68:CREATE INDEX IF NOT EXISTS idx_product_attributes_attribute_id 
supabase\migrations_legacy_sync_20260223193150\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:69:  ON public.product_attributes(attribute_id);
supabase\migrations_legacy_sync_20260223193150\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:140:DROP POLICY IF EXISTS "Product attributes are viewable by everyone" ON public.product_attributes;
supabase\migrations_legacy_sync_20260223193150\20251203131311_cleanup_duplicate_policies_and_fix_remaining.sql:142:  ON public.product_attributes FOR SELECT TO authenticated, anon 
supabase\migrations_legacy_sync_20260223193150\20251203095427_products_attributes_jsonb.sql:42:COMMENT ON COLUMN public.products.attributes IS 
app\actions\products-update.ts:166:    .from("product_attributes")
app\actions\products-update.ts:187:  const { error: insertError } = await supabase.from("product_attributes").insert(attributeRows)
supabase\migrations_legacy_sync_20260223193150\20251203000000_product_attributes_and_display_order.sql:16:-- Source of truth remains in product_attributes table (EAV)
supabase\migrations_legacy_sync_20260223193150\20251203000000_product_attributes_and_display_order.sql:61:COMMENT ON COLUMN public.products.attributes IS 
supabase\migrations_legacy_sync_20260223193150\20251203000000_product_attributes_and_display_order.sql:62:  'Denormalized JSONB attributes for fast filtering. Example: {"make": "BMW", "model": "3 Series", "year": 2020}. Source of truth: product_attributes table (EAV).';
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:31:CREATE TABLE IF NOT EXISTS product_attributes (
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:46:CREATE INDEX IF NOT EXISTS idx_product_attributes_product ON product_attributes(product_id);
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:47:CREATE INDEX IF NOT EXISTS idx_product_attributes_filterable ON product_attributes(name, value) 
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:52:ALTER TABLE product_attributes ENABLE ROW LEVEL SECURITY;
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:62:  ON product_attributes FOR SELECT
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:66:  ON product_attributes FOR ALL
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:70:      WHERE p.id = product_attributes.product_id 
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:77:COMMENT ON TABLE product_attributes IS 'Stores product attribute values - both predefined and custom seller fields';
supabase\migrations_legacy_sync_20260223193150\20251202164050_add_category_attributes_system.sql:78:COMMENT ON COLUMN product_attributes.is_custom IS 'True if seller added this attribute themselves (not from category template)';
supabase\migrations_legacy_sync_20260223193150\20251207184715_cleanup_deep_orphan_categories.sql:41:WHERE id NOT IN (SELECT DISTINCT attribute_id FROM product_attributes WHERE attribute_id IS NOT NULL)
supabase\migrations\20251207184715_cleanup_deep_orphan_categories.sql:41:WHERE id NOT IN (SELECT DISTINCT attribute_id FROM product_attributes WHERE attribute_id IS NOT NULL)
supabase\migrations\20251217041257_remove_duplicate_category_attributes.sql:4:-- Only deleting attributes with 0 usage in product_attributes
supabase\migrations_legacy_sync_20260223193150\20251215100000_security_fixes_phase8.sql:447:ALTER TABLE public.product_attributes ENABLE ROW LEVEL SECURITY;
supabase\migrations\20260101205537_phase1_cleanup_over_engineered_rpcs_20260101.sql:126:DROP INDEX IF EXISTS idx_product_attributes_filterable;
supabase\migrations_legacy_sync_20260223193150\20251217041257_remove_duplicate_category_attributes.sql:4:-- Only deleting attributes with 0 usage in product_attributes
supabase\migrations\20260119195234_add_attribute_key_column.sql:6:-- but `attribute_key` is the snake_case key used in products.attributes JSONB
supabase\migrations\20260119195234_add_attribute_key_column.sql:46:  'Normalized snake_case key matching the key in products.attributes JSONB. Auto-generated from name.';
supabase\migrations_legacy_sync_20260223193150\20260101143157_cleanup_over_engineered_rpcs.sql:126:DROP INDEX IF EXISTS idx_product_attributes_filterable;
supabase\migrations_legacy_sync_20260223193150\20260101170000_cleanup_over_engineered_rpcs.sql:126:DROP INDEX IF EXISTS idx_product_attributes_filterable;
supabase\migrations_legacy_sync_20260223193150\20260101205537_phase1_cleanup_over_engineered_rpcs_20260101.sql:126:DROP INDEX IF EXISTS idx_product_attributes_filterable;
supabase\migrations\20260101143157_cleanup_over_engineered_rpcs.sql:126:DROP INDEX IF EXISTS idx_product_attributes_filterable;
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:7:--  - Sync product_attributes (EAV) -> products.attributes (JSONB)
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:117:CREATE OR REPLACE FUNCTION public.sync_product_attributes_jsonb(p_product_id uuid)
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:137:    FROM public.product_attributes pa
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:204:INSERT INTO public.product_attributes (product_id, attribute_id, name, value, is_custom)
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:217:    FROM public.product_attributes pa
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:235:    PERFORM public.sync_product_attributes_jsonb(r.id);
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:243:CREATE OR REPLACE FUNCTION public.handle_product_attributes_sync()
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:249:  PERFORM public.sync_product_attributes_jsonb(COALESCE(NEW.product_id, OLD.product_id));
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:254:DROP TRIGGER IF EXISTS trg_product_attributes_sync_jsonb ON public.product_attributes;
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:255:CREATE TRIGGER trg_product_attributes_sync_jsonb
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:256:  AFTER INSERT OR UPDATE OR DELETE ON public.product_attributes
supabase\migrations\20260204074337_category_attributes_inherit_scope_and_sync.sql:258:  EXECUTE FUNCTION public.handle_product_attributes_sync();
supabase\migrations\20260224010000_security_hardening.sql:31:REVOKE ALL ON FUNCTION public.handle_product_attributes_sync() FROM anon, authenticated, PUBLIC;
supabase\migrations\20260224010000_security_hardening.sql:32:REVOKE ALL ON FUNCTION public.sync_product_attributes_jsonb(uuid) FROM anon, authenticated, PUBLIC;
supabase\migrations\20260224010000_security_hardening.sql:70:--        'handle_product_attributes_sync',
supabase\migrations\20260224010000_security_hardening.sql:71:--        'sync_product_attributes_jsonb'
supabase\migrations_legacy_sync_20260223193150\20260119195234_add_attribute_key_column.sql:6:-- but `attribute_key` is the snake_case key used in products.attributes JSONB
supabase\migrations_legacy_sync_20260223193150\20260119195234_add_attribute_key_column.sql:46:  'Normalized snake_case key matching the key in products.attributes JSONB. Auto-generated from name.';
supabase\migrations\20260224070000_attribute_cleanup.sql:29:-- B) How many product_attributes reference valid category_attributes?
supabase\migrations\20260224070000_attribute_cleanup.sql:37:--   count(*) AS total_product_attributes
supabase\migrations\20260224070000_attribute_cleanup.sql:38:-- FROM public.product_attributes pa;
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:7:--  - Sync product_attributes (EAV) -> products.attributes (JSONB)
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:117:CREATE OR REPLACE FUNCTION public.sync_product_attributes_jsonb(p_product_id uuid)
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:137:    FROM public.product_attributes pa
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:204:INSERT INTO public.product_attributes (product_id, attribute_id, name, value, is_custom)
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:217:    FROM public.product_attributes pa
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:235:    PERFORM public.sync_product_attributes_jsonb(r.id);
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:243:CREATE OR REPLACE FUNCTION public.handle_product_attributes_sync()
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:249:  PERFORM public.sync_product_attributes_jsonb(COALESCE(NEW.product_id, OLD.product_id));
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:254:DROP TRIGGER IF EXISTS trg_product_attributes_sync_jsonb ON public.product_attributes;
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:255:CREATE TRIGGER trg_product_attributes_sync_jsonb
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:256:  AFTER INSERT OR UPDATE OR DELETE ON public.product_attributes
supabase\migrations_legacy_sync_20260223193150\20260204090000_category_attributes_inherit_scope_and_sync.sql:258:  EXECUTE FUNCTION public.handle_product_attributes_sync();
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:7:--  - Sync product_attributes (EAV) -> products.attributes (JSONB)
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:117:CREATE OR REPLACE FUNCTION public.sync_product_attributes_jsonb(p_product_id uuid)
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:137:    FROM public.product_attributes pa
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:204:INSERT INTO public.product_attributes (product_id, attribute_id, name, value, is_custom)
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:217:    FROM public.product_attributes pa
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:235:    PERFORM public.sync_product_attributes_jsonb(r.id);
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:243:CREATE OR REPLACE FUNCTION public.handle_product_attributes_sync()
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:249:  PERFORM public.sync_product_attributes_jsonb(COALESCE(NEW.product_id, OLD.product_id));
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:254:DROP TRIGGER IF EXISTS trg_product_attributes_sync_jsonb ON public.product_attributes;
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:255:CREATE TRIGGER trg_product_attributes_sync_jsonb
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:256:  AFTER INSERT OR UPDATE OR DELETE ON public.product_attributes
supabase\migrations_legacy_sync_20260223193150\20260204074337_category_attributes_inherit_scope_and_sync.sql:258:  EXECUTE FUNCTION public.handle_product_attributes_sync();
