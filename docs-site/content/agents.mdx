# AGENTS.md â€” Treido Operating Contract

Single operating contract for AI agents and developers.

## Read Order

1. `AGENTS.md` (repo root) for fast routing.
2. `docs/AGENTS.md` (this file) for execution policy.
3. `docs/WORKFLOW.md` for build/review loop.
4. Path-local `*/AGENTS.md` for folder boundaries.

## How Any Prompt Is Processed

1. Parse intent:
   - implement, fix, refactor, review, explain, plan, or audit.
2. Parse scope:
   - explicit paths, "do not touch" constraints, risk domain.
3. Resolve constraints in this order:
   - system/developer instructions
   - repo root `AGENTS.md`
   - this file
   - path-local `AGENTS.md` files
   - user request details
4. Select minimal skills by intent using `docs/AGENT-MAP.md`.
5. Gather local truth first:
   - search files, inspect current implementation, avoid guessing.
6. Decide risk lane:
   - low-risk: UI/docs/refactor/tests
   - high-risk: DB/auth/payments/destructive operations
7. Execute in small batches with verification.
8. Report:
   - changed files, commands run, results, remaining risks.

## Source Precedence (Truth Model)

1. Code and migrations are runtime truth.
2. `docs/status/LAUNCH-READINESS.yaml` is launch-status truth.
3. `docs/**` is writing SSOT.
4. `docs-site/**` is generated browse mirror only.
5. `.codex/TASKS.md`, `.codex/DECISIONS.md`, `.codex/SHIPPED.md` are runtime working state.

If docs and code disagree, treat code/runtime as current truth and update docs.

## Non-Negotiables

- No secrets or PII in logs.
- User-facing copy uses `next-intl` keys.
- Tailwind v4 semantic tokens only.
- Prefer Server Components; use client components only when needed.
- Keep shared UI free of direct data fetching and server actions.

## High-Risk Pause Domains

Stop and explicitly align with a human before finalizing these changes:

- DB schema, migrations, or RLS policies.
- Auth/session/access-control behavior.
- Payments, Stripe, webhook behavior.
- Destructive or bulk data operations.

## Skill Routing

- Use `docs/AGENT-MAP.md` for intent-to-skill mapping.
- `treido-rails` applies to all implementation tasks.
- Use orchestrator skills only when multiple domains are coupled.

## Folder Boundaries

- `app/**/_components/*` and `app/**/_actions/*`: route-private.
- `app/actions/*`: shared server actions.
- `components/ui/*`: primitives only.
- `components/shared/*`: shared composites, no direct Supabase/Stripe calls.
- `lib/*`: pure utilities.

## Output Contract

For implementation work, always include:

1. Files changed.
2. Verification commands and outcomes.
3. Any assumptions, limitations, or deferred risks.

For review requests, findings come first (ordered by severity with file references).

Last updated: 2026-02-06
