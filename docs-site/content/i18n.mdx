# I18N.md — i18n Domain Contract

> next-intl setup for Treido: locale routing, message loading, and formatting defaults.

| Field | Value |
|-------|-------|
| Owner | treido-orchestrator |
| Last verified | 2026-02-13 |
| Refresh cadence | Weekly + whenever locale behavior changes |

## Scope

Locale routing (`/en`, `/bg`), translations, and localized formatting behavior.

## Runtime Truth Paths

- `i18n/routing.ts` (supported locales + navigation helpers)
- `i18n/request.ts` (request-scoped message loading + formatting defaults)
- `proxy.ts` (next-intl middleware integration)
- `messages/en.json`, `messages/bg.json` (translation dictionaries)
- `app/[locale]/**` (all user-facing routes)

## Quick Reference

| Concern | Contract |
|--------|----------|
| Supported locales | `en`, `bg` (`i18n/routing.ts`) |
| Default locale | `en` |
| URL structure | Always prefixed (`/en/...`, `/bg/...`) |
| Locale cookie | `NEXT_LOCALE` (1 year) |
| Navigation helpers | Use `Link`, `redirect`, `useRouter` from `@/i18n/routing` |

## Locale Contract

- Supported locales: `en`, `bg` (`i18n/routing.ts`).
- Locale prefix is always present in URLs (`localePrefix: 'always'`).
- Locale detection is enabled via next-intl (cookie + Accept-Language).

## Message Loading + Fallbacks

- Messages are loaded from `messages/${locale}.json` in `i18n/request.ts`.
- Missing translation behavior:
  - Development: warns and renders a visible fallback (`[namespace.key]`).
  - Production: does not render raw keys (returns an empty string fallback).

## Formatting Defaults

`i18n/request.ts` defines global formats for:

- Dates (`short`, `long`, `delivery`, `order`)
- Numbers (`currency`, `precise`, `percent`, `integer`)
- Lists (`enumeration`, `options`)

## Routing + Navigation Rules

- Use locale-aware navigation from `@/i18n/routing` (`Link`, `redirect`, `useRouter`, etc.).
- Do not hand-roll locale prefixes in string concatenation unless you have a concrete reason.

## Adding/Updating Translations

- Keep keys stable; prefer namespaced groups (`Header.*`, `Auth.*`, etc.).
- Update both `messages/en.json` and `messages/bg.json` when adding new UI text.

## Common Gotchas

- Don’t import `next/link` directly for app navigation; prefer `@/i18n/routing` so locale prefixes stay correct.
- Server vs client APIs:
  - Server: `getTranslations()` + `setRequestLocale()`
  - Client: `useTranslations()`
- Avoid rendering raw translation keys in production (fallback is intentionally empty in prod).

## Verification

- Smoke navigation: `REUSE_EXISTING_SERVER=true pnpm -s test:e2e:smoke`

## Deep Dive

- Pre-cutover full reference: `docs/archive/2026-02-doc-reset/pre-cutover-docs/I18N.md` (`docs/archive/2026-02-doc-reset/pre-cutover-docs/I18N.md`)

## See Also

- [`ARCHITECTURE.md`](../../ARCHITECTURE.md)
- [`docs/QA.md`](/qa)
- [`REQUIREMENTS.md`](../../REQUIREMENTS.md)

*Last updated: 2026-02-13*

