# Selling & Listings

## Goal

Enable users to list items for sale through an auth-gated, multi-step wizard with image upload, category/attribute selection, and draft/publish flow. Sellers manage their listings via a personal dashboard, track orders, and (for business accounts) access listing analytics.

## Current Status

- Requirements: 12/14 complete (R2: 7/8 + R5: 5/6) â€” see REQUIREMENTS.md Â§R2, Â§R5
- Production: ðŸŸ¡ Partial â€” listing analytics not started; refund processing admin-assisted

## Requirements Mapping

| Req ID | Description | Status |
|--------|-------------|--------|
| R2.1 | Auth-gated sell entry (`/sell`) | âœ… |
| R2.2 | Multi-step listing wizard (title, desc, category, attributes, images, price) | âœ… |
| R2.3 | Image upload (multi-image, drag-reorder, compression) | âœ… |
| R2.4 | Category + attribute selection | âœ… |
| R2.5 | Draft â†’ publish flow | âœ… |
| R2.6 | Edit listing | âœ… |
| R2.7 | Delete / unpublish listing | âœ… |
| R2.8 | Listing analytics (business tier only) | â¬œ Not started |
| R5.1 | Seller orders list | âœ… |
| R5.2 | Seller order detail | âœ… |
| R5.3 | Mark as shipped | âœ… |
| R5.4 | Mark as delivered | âœ… |
| R5.5 | Process refund (admin-assisted) | ðŸŸ¡ In progress |
| R5.6 | Inventory updates (DB triggers) | âœ… |

## Implementation Notes

### Routes

| Path | Group | Auth |
|------|-------|------|
| `/sell` | (sell) | auth |
| `/sell/orders` | (sell) | seller |
| `/seller/dashboard` | (main) | seller |
| `/seller/settings/payouts` | (main) | seller |
| `/account/selling` | (account) | seller |
| `/account/selling/edit` | (account) | seller |
| `/account/selling/:id/edit` | (account) | seller |
| `/account/sales` | (account) | seller |

### API Endpoints

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/products/:id/view` | POST | Track product view |
| `/api/upload-image` | POST | Upload product image |
| `/api/seller/limits` | GET | Seller listing/price limits |
| `/api/sales/export` | GET | Export sales data |
| `/api/orders/:id/ship` | POST | Mark order shipped |
| `/api/orders/:id/track` | GET | Order tracking |

### Server Actions

- `products.ts` â€” Product CRUD (create, update, delete, publish, unpublish)
- `profile.ts` â€” Seller profile updates

### DB Tables

| Table | Purpose |
|-------|---------|
| `products` | Listings with full-text search vector, JSONB attributes, status (active/draft/archived) |
| `product_attributes` | EAV attribute values per product |
| `product_variants` | Size/color variants with SKU and stock |
| `product_private` | Seller-only data (cost price, SKU, barcode) |
| `categories` | Hierarchical L0â†’L3 category tree |
| `category_attributes` | Dynamic form fields per category |
| `brands` | Brand info with logos |
| `order_items` | Line items linking orders â†’ products â†’ sellers, with tracking |

### Key DB Functions

- `handle_new_product_search()` â€” Updates full-text search vector on product insert/update
- `sync_product_attributes_jsonb()` â€” Syncs EAV attributes to JSONB column
- `normalize_attribute_key()` â€” Normalizes attribute keys for consistent querying
- `decrement_stock_on_order()` â€” Decrements variant stock when order is placed

## Known Gaps & V1.1+ Items

| Item | Status | Notes |
|------|--------|-------|
| R2.8: Listing analytics | â¬œ Not started | Business tier only; dashboard analytics page exists but listing-level metrics not wired |
| R5.5: Process refund | ðŸŸ¡ In progress | Currently admin-assisted; self-service refund initiation deferred |
| Bulk listing operations | â¬œ Deferred | V1.1 â€” bulk edit/delete for high-volume sellers |
| AI Listing Assistant | â¬œ Deferred | V2 â€” AI autofill from photos (`/api/assistant/sell-autofill` endpoint exists) |

## Cross-References

- [PAYMENTS.md](/payments) â€” Stripe Connect onboarding, payout release, escrow lifecycle
- [DATABASE.md](/database) â€” Products schema, category hierarchy, full-text search
- [ROUTES.md](/routes) â€” (sell) and (account) route groups
- [API.md](/api) â€” Product and upload endpoints
- DESIGN.md Â§8.5 â€” Sell drawer / wizard UX pattern
- [app-feel.md](./app-feel.md) â€” SellDrawer component spec, multi-step wizard pattern

---

*Last updated: 2026-02-08*
