# Webhooks & Idempotency

## Non-negotiables

- Treat Stripe webhooks as the source of truth.
- Make every webhook handler **idempotent**.
- Never log secrets (Stripe signatures, request bodies with PII).

## Events to handle (minimum)

- `payment_intent.succeeded` / `payment_intent.payment_failed`
- `charge.refunded`
- `charge.dispute.created` / `charge.dispute.closed`
- `account.updated` (Connect onboarding / payouts enabled)

## Implementation notes

- Verify signature (Stripe webhook secret).
- Persist each event id and short-circuit duplicates.
- Update order state only via server-side handlers.
