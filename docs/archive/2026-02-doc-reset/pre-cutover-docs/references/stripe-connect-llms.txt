# Stripe Connect Reference (Marketplace Patterns)
# Version: Stripe API 2025-12-15.clover
# Last fetched: 2026-02-12

## Separate Charges and Transfers (SCT)

Treido uses SCT for escrow-style control:

1. Customer pays platform → Charge created on platform account
2. Platform holds funds (escrow period)
3. On delivery confirmation → Transfer to seller's Connect account

```typescript
// Create charge with transfer_data
const paymentIntent = await stripe.paymentIntents.create({
  amount: totalAmount,
  currency: 'eur',
  customer: customerId,
  transfer_group: `order_${orderId}`,
})

// Transfer to seller after escrow
const transfer = await stripe.transfers.create({
  amount: sellerAmount,
  currency: 'eur',
  destination: sellerStripeAccountId,
  transfer_group: `order_${orderId}`,
})
```

## Connect Account Types

- Express accounts: Stripe-hosted onboarding, dashboard
- `stripe.accounts.create({ type: 'express', ... })`
- `stripe.accountLinks.create({ account, type: 'account_onboarding', ... })`

## Fee Calculation

```
buyerTotal = productPrice + buyerProtectionFee + shippingCost
sellerPayout = productPrice - platformFee
platformRevenue = buyerProtectionFee + platformFee
```

## Key Webhooks

- `checkout.session.completed` — order creation
- `payment_intent.succeeded` — payment confirmed
- `account.updated` — Connect account status changes
- `customer.subscription.updated` — subscription lifecycle
- `charge.dispute.created` — dispute handling
